'''
Github: https://github.com/MohamedEmbaby00/Pentesting-Tools
Usage:
	Example: python3 dir-searcher.py -H http://127.0.0.1/ -w wordlist.txt		--> (Default: 404 status code is hidden)
	Example: python3 dir-searcher.py -H https://target.com -w wordlist.txt -hc 303,403,500
	Example: python3 dir-searcher.py -H http://127.0.0.1/ -w wordlist.txt -x php,html -t 200
'''

import requests, concurrent.futures, argparse, colorama
from socket import gethostbyname
from termcolor import colored
from time import time


parser = argparse.ArgumentParser(description='========== Simple Directory Searcher ==========', usage='python3 dir-searcher.py -H <host> -w <wordlist>')
parser.add_argument('-H', '--host', metavar='', required=True, help='Host to scan')
parser.add_argument('-w', '--wordlist', metavar='', required=True, help='Path to a wordlist')
parser.add_argument('-hc', '--hide', metavar='', help='Status code to hide')
parser.add_argument('-x', '--extensions', metavar='', help='File extension(s) to search for')
parser.add_argument('-t', '--threads', metavar='', help='Number of concurrent threads (default:10)', type=int, default=100)
args = parser.parse_args()

colorama.init()
wordlist = open(args.wordlist, encoding='utf8')

if not args.host.startswith(('http://', 'https://')):
	print ('[-] Error, Enter a valid url')
	exit(0)

if not args.host.endswith('/'):
	args.host+= '/'

if args.extensions:
	extensions = args.extensions.split(',')

start_time = time()

try:
	gethostbyname(args.host.split('/')[2])
	print (colored('[*] Starting Dir-searcher...', 'yellow'))
except:
	print (colored('[-] Unable to resolve hostname!', 'red'))
	exit(0)


def code_check(request):
	if request.status_code != 404:
		if args.hide:
			if ',' in args.hide:
				codes_to_hide = list(map(int,args.hide.split(',')))
				if request.status_code not in codes_to_hide:
					print (colored(f'[*] {request.url} (Status: {request.status_code})', 'green'))
				else:
					pass
			elif ((',' not in args.hide) and (request.status_code != int(args.hide))):
				print (colored(f'[*] {request.url} (Status: {request.status_code})', 'green'))
			else:
				pass
				exit(0)
		else:
			print (colored(f'[*] {request.url} (Status: {request.status_code})', 'green'))
	else:
		pass


def fuzzer(word):
	req = requests.get(args.host + word.strip(), timeout=3)
	code_check(req)
	if extensions:
		for extension in extensions:
			req = requests.get(args.host + word.strip() + '.' + extension, timeout=3)
			code_check(req)


with concurrent.futures.ThreadPoolExecutor(max_workers=args.threads) as executor:
	executor.map(fuzzer, wordlist.readlines())

wordlist.close()
end_time = time()
print (colored(f'\r\n[*] Finished in {end_time-start_time} Second(s)', 'yellow'))
